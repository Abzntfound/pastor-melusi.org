<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ask Pastor Melusi | FAQ</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Crimson+Pro:wght@300;400;600&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .faq-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 5%;
        }

        .user-info-bar {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--gold);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info-bar p {
            margin: 0;
            color: var(--text-dark);
        }

        .user-info-bar strong {
            color: var(--gold);
        }

        .logout-btn {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
            padding: 0.5rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: var(--gold);
            color: var(--deep-blue);
        }

        .submit-question-section {
            background: var(--white);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 4rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .submit-question-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--deep-blue);
            margin-bottom: 1rem;
        }

        .submit-question-section p {
            color: #666;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--gold) 0%, #B8860B 100%);
            color: var(--deep-blue);
            padding: 1.2rem 3rem;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Crimson Pro', serif;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .questions-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: var(--deep-blue);
            margin-bottom: 2rem;
            text-align: center;
        }

        .faq-item {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
        }

        .faq-item:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }

        .question-meta {
            flex: 1;
        }

        .question-author {
            font-weight: 600;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .question-date {
            font-size: 0.9rem;
            color: #666;
        }

        .question-category {
            background: rgba(212, 175, 55, 0.2);
            color: var(--deep-blue);
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .question-text {
            font-size: 1.2rem;
            color: var(--text-dark);
            line-height: 1.8;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .response-section {
            background: rgba(212, 175, 55, 0.05);
            border-left: 4px solid var(--gold);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
        }

        .response-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--gold);
            font-weight: 700;
        }

        .response-text {
            color: var(--text-dark);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .no-response {
            color: #999;
            font-style: italic;
            padding: 1rem;
            text-align: center;
        }

        .status-badge {
            display: inline-block;
            padding: 0.3rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(255, 152, 0, 0.2);
            color: #ff6f00;
        }

        .status-answered {
            background: rgba(76, 175, 80, 0.2);
            color: #2e7d32;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            display: none;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        @media (max-width: 768px) {
            .submit-question-section {
                padding: 2rem 1.5rem;
            }

            .question-header {
                flex-direction: column;
                gap: 1rem;
            }

            .user-info-bar {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav id="navbar">
        <div class="nav-container">
            <a href="/pastor-melusi.org/" class="logo">PASTOR MELUSI</a>
            <ul class="nav-links">
                <li><a href="/pastor-melusi.org/">Home</a></li>
                <li><a href="/pastor-melusi.org/about/">About</a></li>
                <li><a href="/pastor-melusi.org/ministry/">Ministry</a></li>
                <li><a href="/pastor-melusi.org/events/">Events</a></li>
                <li><a href="/pastor-melusi.org/gallery/">Gallery</a></li>
                <li><a href="/pastor-melusi.org/contact-us/">Contact</a></li>
            </ul>
            <a href="/pastor-melusi.org/faq.html" class="contact-btn">Ask a Question</a>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="page-header-content">
            <div class="subtitle">ASK PASTOR MELUSI</div>
            <h1>Prayer Requests & Questions</h1>
        </div>
    </section>

    <!-- Main Content -->
    <div class="faq-container">
        <!-- User Info Bar -->
        <div class="user-info-bar" id="userInfoBar">
            <p>Welcome, <strong id="userName"></strong> (<span id="userEmail"></span>)</p>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <!-- Alerts -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>
        <div id="alertInfo" class="alert alert-info"></div>

        <!-- Submit Question Section -->
        <div class="submit-question-section">
            <h2>Submit Your Question</h2>
            <p>Pastor Melusi will personally review and respond to your prayer request or question. You'll receive a response via email.</p>

            <form id="questionForm">
                <div class="form-group">
                    <label for="category">Category</label>
                    <select id="category" name="category" required>
                        <option value="">Select a category</option>
                        <option value="Prayer Request">Prayer Request</option>
                        <option value="Spiritual Guidance">Spiritual Guidance</option>
                        <option value="Ministry Question">Ministry Question</option>
                        <option value="Bible Study">Bible Study</option>
                        <option value="Counseling">Counseling</option>
                        <option value="General Question">General Question</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subject">Subject</label>
                    <input type="text" id="subject" name="subject" required placeholder="Brief subject of your question">
                </div>

                <div class="form-group">
                    <label for="question">Your Question / Prayer Request</label>
                    <textarea id="question" name="question" required placeholder="Please share your question or prayer request in detail..."></textarea>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn">
                    Submit Question
                </button>
            </form>
        </div>

        <!-- Questions Section -->
        <div class="questions-section">
            <h2>Recent Questions & Responses</h2>
            <div id="questionsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading questions...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 International Breakthrough Ministries. All Rights Reserved.</p>
        <p style="margin-top: 1rem;">Led by Pastor Melusi | Spreading the Gospel Worldwide</p>
    </footer>

    <script>
        // Configuration - REPLACE WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbww9uIzfd1fsS223PzKgV2gO_kmrzWRTtLHZEzvNLh9ppWEDgxZS2MV-FYxe8utSwbzQg/exec';

        // Check if user is logged in
        let currentUser = null;

        window.addEventListener('DOMContentLoaded', function() {
            const userData = localStorage.getItem('pastorMelusiUser');
            
            if (!userData) {
                // User is not logged in, redirect to login page
                window.location.href = '/pastor-melusi.org/login.html';
                return;
            }
            
            currentUser = JSON.parse(userData);
            
            // Display user info
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userEmail').textContent = currentUser.email;
            
            // Load questions
            loadQuestions();
        });

        // Logout function
        function logout() {
            localStorage.removeItem('pastorMelusiUser');
            window.location.href = '/pastor-melusi.org/login.html';
        }

        // Submit question
        document.getElementById('questionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            const formData = {
                action: 'submitQuestion',
                name: currentUser.fullName,
                email: currentUser.email,
                category: document.getElementById('category').value,
                subject: document.getElementById('subject').value,
                question: document.getElementById('question').value,
                timestamp: new Date().toISOString()
            };
            
            try {
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                showAlert('success', 'Your question has been submitted successfully! Pastor Melusi will respond via email.');
                
                // Reset form
                document.getElementById('questionForm').reset();
                
                // Reload questions after short delay
                setTimeout(loadQuestions, 2000);
                
            } catch (error) {
                console.error('Error:', error);
                showAlert('error', 'There was an error submitting your question. Please try again or contact us directly.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Question';
            }
        });

        // Load questions from Google Sheets
        async function loadQuestions() {
            const container = document.getElementById('questionsContainer');
            
            try {
                const response = await fetch(`${SCRIPT_URL}?action=getQuestions`);
                const data = await response.json();
                
                if (data.questions && data.questions.length > 0) {
                    container.innerHTML = data.questions.map(q => createQuestionHTML(q)).join('');
                } else {
                    container.innerHTML = '<p class="no-response">No questions yet. Be the first to ask!</p>';
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                // Show sample questions for demo purposes
                container.innerHTML = getSampleQuestionsHTML();
            }
        }

        // Create HTML for a question
        function createQuestionHTML(question) {
            const hasResponse = question.response && question.response.trim() !== '';
            const statusClass = hasResponse ? 'status-answered' : 'status-pending';
            const statusText = hasResponse ? 'Answered' : 'Pending Response';
            
            return `
                <div class="faq-item">
                    <div class="question-header">
                        <div class="question-meta">
                            <div class="question-author">${question.name}</div>
                            <div class="question-date">${formatDate(question.timestamp)}</div>
                        </div>
                        <div>
                            <span class="question-category">${question.category}</span>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="question-text">
                        <strong>${question.subject}</strong><br>
                        ${question.question}
                    </div>
                    ${hasResponse ? `
                        <div class="response-section">
                            <div class="response-header">
                                <strong>↪ Pastor Melusi's Response:</strong>
                            </div>
                            <div class="response-text">${question.response}</div>
                        </div>
                    ` : `
                        <div class="no-response">Awaiting Pastor Melusi's response...</div>
                    `}
                </div>
            `;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return date.toLocaleDateString('en-GB', options);
        }

        // Show alert
        function showAlert(type, message) {
            const alertId = `alert${type.charAt(0).toUpperCase() + type.slice(1)}`;
            const alertDiv = document.getElementById(alertId);
            alertDiv.textContent = message;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Sample questions for demo
        function getSampleQuestionsHTML() {
            return `
                <div class="faq-item">
                    <div class="question-header">
                        <div class="question-meta">
                            <div class="question-author">John Smith</div>
                            <div class="question-date">January 15, 2025, 14:30</div>
                        </div>
                        <div>
                            <span class="question-category">Prayer Request</span>
                            <span class="status-badge status-answered">Answered</span>
                        </div>
                    </div>
                    <div class="question-text">
                        <strong>Prayer for healing</strong><br>
                        Please pray for my mother who is recovering from surgery. She needs strength and healing.
                    </div>
                    <div class="response-section">
                        <div class="response-header">
                            <strong>↪ Pastor Melusi's Response:</strong>
                        </div>
                        <div class="response-text">
                            Dear John, I am lifting your mother up in prayer for complete healing and restoration. 
                            The Lord is our healer, and by His stripes we are healed (Isaiah 53:5). I pray that God's 
                            healing power flows through her body, giving her strength each day. Trust in the Lord's 
                            perfect timing and His unfailing love. I will continue to keep her in my prayers. 
                            God bless you and your family.
                        </div>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="question-header">
                        <div class="question-meta">
                            <div class="question-author">Sarah Williams</div>
                            <div class="question-date">January 20, 2025, 10:15</div>
                        </div>
                        <div>
                            <span class="question-category">Spiritual Guidance</span>
                            <span class="status-badge status-pending">Pending Response</span>
                        </div>
                    </div>
                    <div class="question-text">
                        <strong>Struggling with faith</strong><br>
                        I've been going through a difficult time and finding it hard to maintain my faith. 
                        How can I strengthen my relationship with God during trials?
                    </div>
                    <div class="no-response">Awaiting Pastor Melusi's response...</div>
                </div>
            `;
        }
    </script>
</body>
</html>
